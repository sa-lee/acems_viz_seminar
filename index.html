<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Visualising in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Ursula Laa and Stuart Lee" />
    <link href="libs/remark-css/kunoichi.css" rel="stylesheet" />
    <link href="libs/remark-css/ninjutsu.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">

layout: false
class: split-33 with-thick-border border-black

&lt;style type="text/css"&gt;
/* custom.css */
:root{
  --main-color1: #2f4c7a;
  --main-color2: #bcbddc;
  --main-color3: #efedf5;
  --main-color4: #9DDAE5;
  --text-color3: black;
  --text-color4: black;
  --code-inline-color: #4e5054;
  --link-color: #006CAB;
  --logo: url(http://www.fragiletoagile.com.au/wp-content/uploads/2018/02/monash-university-logo-transparent.png);
}
.huge { font-size: 300% }
.large { font-size: 150% }
.largeish { font-size: 120% }
.summarystyle { font-size: 150%;
  line-height:150%;}

.left-code {
  color: #777;
  width: 48%;
  height: 92%;
  float: left;
}
.right-plot {
  width: 50%;
  float: right;
  padding-left: 1%;
}
&lt;/style&gt;







.column[.bottom_abs.content[
&lt;img src="http://www.fragiletoagile.com.au/wp-content/uploads/2018/02/monash-university-logo-transparent.png" width="70%"&gt;
]]

.column.bg-main1[.content.vmiddle[.center[


# Data Visualisation with R


### ggplot2 and friends!
&lt;br&gt;
&lt;br&gt;

# Ursula Laa
# and
# Stuart Lee

]]]

---
layout: false
class: split-50 with-thick-border border-white
.column[.content[
# Who are we?

## Ursula Laa
.large[
- Research fellow at Monash University
- Working in particle physics and data visualisation
- Interested in visualisation of high-dimensional data
]

XXX tour animation?
]]

.column[.content[

# &lt;br&gt;

## Stuart Lee

.large[
- PhD student at Monash University
- ...
- ...
]

XXX 
]]


---

# Follow along with us

&lt;br&gt;

.large[The material for todays seminar is available online]

&lt;br&gt;


.largeish[
Get the slides from https://sa-lee.github.io/acems_viz_seminar/

Get the source code from https://github.com/sa-lee/acems_viz_seminar
]

&lt;br&gt;

.large[Just open RStudio to go along with the examples!]

---

# A grammar of graphics



.large[
The grammar of graphics defines a framework to construct statistical graphics in a principled way, by definind an explicit relationship between the variables in the data you have and the graphic or plot you wish to represent. It was first defined by Lee Wilkinson and extended by Hadley Wickham in the R package `ggplot2`. 
]

--

### `ggplot2` is based on three simple concepts:

.large[
* __Data__: input data should be formated in a data frame, where each column is a variable, and each row is an observation
* __Mapping__: declaring a mapping of input data variables onto aestetics
* __geoms__: the graphical primitives, e.g. geom_line, geom_point
]


--

### Here we uncover how the charts you know by name can be created via `ggplot2`, learn how to construct a `ggplot2` graphic and then build a plot up, layer-by-layer.


---

# Why use the grammar of graphics?

&lt;br&gt;

.large[
The grammar of graphics

- allows us to __define__ the mapping between variables in the data, with elements of the plot
- allows us to see and understand __how__ plots are similar or different
- helps us see how variations in the definition create variations in the plot
]

&lt;br&gt;

### Using named plots, for example a pie chart, bar chart, scatterplot, in some ways is like seeing animals in the zoo.


---

# Example data

### World Health Organisation (WHO) tuberculosis case notifications data 

&lt;br&gt;

.large[To showcase `ggplot2` we will build graphics using a data set provided by the [World Health Organisation (WHO)](https://www.who.int/). This is current tuberculosis (TB) case notifications aggregated by __country__, __gender__ and __age__ group. We have tidied up this data for you and saved it in the R data storage format.]


.largeish[
The data consists of six columns:

* __country:__ the country where the TB case(s) occured
* __iso3:__ a three letter standardised country code
* __year:__ the year when the TB case(s) occured
* __gender:__ whether the TB case(s) belonged to males or females.
* __age_group:__ whether the TB case(s) belonged to someone aged between 15 to 24, 25 to 34,
35 to 44, 45 to 54, 55 to 64 or 65 and above
* __count:__ the total number of TB cases for a given country, year, gender and age group.
]
---



# Load the data in RStudio on your computer

.largeish[On your computer, open RStudio and then load the TB data in with R using the tidyverse:]


```r
library(tidyverse)
tb &lt;- read_rds("data/tb_tidy.rds")
tb_au &lt;- filter(tb, country == "Australia", !is.na(age_group))
tb_au
```

```
## # A tibble: 192 x 6
##    country   iso3   year count gender age_group
##    &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;    
##  1 Australia AUS    1997     8 M      15-24    
##  2 Australia AUS    1998    11 M      15-24    
##  3 Australia AUS    1999    13 M      15-24    
##  4 Australia AUS    2000    16 M      15-24    
##  5 Australia AUS    2001    23 M      15-24    
##  6 Australia AUS    2002    15 M      15-24    
##  7 Australia AUS    2003    14 M      15-24    
##  8 Australia AUS    2004    18 M      15-24    
##  9 Australia AUS    2005    32 M      15-24    
## 10 Australia AUS    2006    33 M      15-24    
## # â€¦ with 182 more rows
```



---

# A first look

.largeish[Let's create charts from the TB data to find out if there are differences between age groups, and gender between TB cases in Australia.

We start with a 100% chart, that compares the proportion of TB cases in each age group by gender.]

&lt;br&gt;

&lt;img src="./figures/unnamed-chunk-2-1.png" style="display: block; margin: auto;" /&gt;

---

# A first look

.largeish[Let's create charts from the TB data to find out if there are differences between age groups, and gender between TB cases in Australia.

We start with a 100% chart, that compares the proportion of TB cases in each age group by gender.]

&lt;br&gt;

## What can you learn from a 100% chart? 

.largeish[
There are three key lessons from this chart:

 * The focus is on **proportion** in each category. 
 * Across (almost) all ages, and years, the proportion of males having TB is higher than females
 * These proportions tend to be higher in the older age groups, for all years.
]

---

class: middle center bg-main1

# Building your own ggplot

---

layout: false
class: split-33

.column[.content[
## Stepwise building of a `ggplot2`


We start by passing our *data set* to the ggplot function




```r
*ggplot(tb_au)
```

]]

.column[.content.vmiddle[
&lt;img src="./figures/output1-1.png" style="display: block; margin: auto;" /&gt;
]]

---

layout: false
class: split-33

.column[.content[
## Stepwise building of a `ggplot2`


We next call `aes()` to define the *aesthetic mapping* (or *variable mapping*)



```r
ggplot(tb_au) +
* aes(x = year,
*     y = count,
*     fill = gender)
```

]]

.column[.content.vmiddle[
&lt;img src="./figures/output2-1.png" style="display: block; margin: auto;" /&gt;
]]

---

layout: false
class: split-33

.column[.content[
## Stepwise building of a `ggplot2`

Now we specify the geom we want to draw 


```r
ggplot(tb_au) +
  aes(x = year, 
      y = count, 
      fill = gender) +
* geom_bar(stat = "identity",
*          position = "fill")
```

.largeish[
- `stat = "identity"` says no need to compute the count (it is already counted in the data)
- `position = "fill"` sets the heights of the bars to be all at 100%, this emphasizes the proportion of males and females
]
]]

.column[.content.vmiddle[
&lt;img src="./figures/output3-1.png" style="display: block; margin: auto;" /&gt;
]]

---

layout: false
class: split-33

.column[.content[
## Stepwise building of a `ggplot2`

We can easily change things like the color palette


```r
ggplot(tb_au) +
  aes(x = year, 
      y = count, 
      fill = gender) +
  geom_bar(stat = "identity", 
           position = "fill") +
* scale_fill_brewer(
*   palette = "Dark2")
```

.largeish[
Here we use a palette from [colorbrewer.org](colorbrewer.org) that accommodates colour blindness.
]
]]

.column[.content.vmiddle[
&lt;img src="./figures/output4-1.png" style="display: block; margin: auto;" /&gt;
]]

---

layout: false
class: split-33

.column[.content[
## Stepwise building of a `ggplot2`

Finally we create a bar chart for each age group by facetting


```r
ggplot(tb_au) +
  aes(x = year, 
      y = count, 
      fill = gender) +
  geom_bar(stat = "identity", 
           position = "fill") +
  scale_fill_brewer(  
    palette = "Dark2") +
* facet_grid(. ~ age_group)
```

.largeish[
A `facet` creates subplots for each category (or combination of categories) laid out in a grid. The argument is specified as a *formula*, and is of the form left hand side ~ right hand side.
]
]]

.column[.content.vmiddle[
&lt;img src="./figures/output5-1.png" style="display: block; margin: auto;" /&gt;
]]

---

# Final plot

We created a `ggplot` one layer at a time. Once you become more confident you will be able to start building everything up at once.


```r
p &lt;- ggplot(tb_au, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity", position = "fill") +
  facet_grid(~ age_group) +
  scale_fill_brewer(palette="Dark2")
p
```

&lt;img src="./figures/unnamed-chunk-3-1.png" style="display: block; margin: auto;" /&gt;

---

# Changing things up

.large[
We can easily change how the plot is defined and compare different ways of showing the same data.
You can make a bar chart using `ggplot2` by changing the position argument in `geom_bar()` to `stack`: 
]


```r
p &lt;- ggplot(tb_au, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity", position = "stack") +
  facet_grid(~ age_group) +
  scale_fill_brewer(palette="Dark2")
p
```

&lt;img src="./figures/unnamed-chunk-4-1.png" style="display: block; margin: auto;" /&gt;

---

# Changing things up

.large[
We can easily change how the plot is defined and compare different ways of showing the same data.
You can make a bar chart using `ggplot2` by changing the position argument in `geom_bar()` to `stack`: 
]

## What we learn from this chart? 

.largeish[
- Focus on **counts**, it shows that counts are different across __ages__, and __years__: counts tend to be lower in middle age (45-64). 
- Shows that in the year 1999, there was a bit of a TB outbreak in most age groups, with numbers doubling or tripling compared to other years. The TB Incidence has been increasing among younger age groups in recent years.
]


---

# From 'stacked' to 'side-by-side'

.large[Let's change the position argument in `geom_bar()` to `dodge` to show the counts in each age category but with respect to __gender__]


```r
ggplot(tb_au, aes(x = year, y = count, fill = gender)) +
  geom_bar(stat = "identity", position="dodge") +
  facet_grid(~ age_group) +
  scale_fill_brewer(palette="Dark2")
```

&lt;img src="./figures/unnamed-chunk-5-1.png" style="display: block; margin: auto;" /&gt;

---

# What can you learn from this chart? 

&lt;img src="./figures/unnamed-chunk-6-1.png" style="display: block; margin: auto;" /&gt;

.largeish[
- Focus on counts by gender, showing predominantly male incidence of TB.
- You can also see that incidence among males relative to females is from middle age onwards. There appears to be
similar incidence between males and females in younger age groups.
]

.largeish[What's changed from your previous charts? The colours, aesthetics and facets have remained the same, it's just the __position__ of the bars that have been altered ]

---

# Beyond bar charts

&lt;img src="./figures/unnamed-chunk-7-1.png" style="display: block; margin: auto;" /&gt;

.large[This rainbow chart is visually appealling, but it's difficult to interpret. In what way could use `ggplot2` to make the chart easier to interpet?]

---
layout: false
class: split-33

.column[.content[
# Changing coordinates



```r
ggplot(
  tb_au,
  aes(x = year,
      y = count,
      fill = gender)
  ) +
  geom_bar(
    stat = "identity"
    ) +
  facet_grid(
    gender ~ age_group
    ) +
  scale_fill_brewer(
    palette="Dark2"
    ) + 
  coord_polar() 
```
]]

.column[.content[
.largeish[
By changing the cartesian coordinates to __polar__, things will be layed out in __circles__, rather than __rectangles__. 
When using polar coordinates, one axis is mapped to an __angle__, rather than a position.
]
&lt;img src="./figures/outputPolar-1.png" style="display: block; margin: auto;" /&gt;
.large[This layout makes it easier to interpret how the chart emphasises the middle age groups as having low incidence accross the years.]

]]




---
layout: false
class: split-33

.column[.content[
# Transform from rainbox to pie

You can continue to use polar coordinates to modify your rainbow chart and transform it to a pie chart. 



```r
ggplot(tb_au,
       aes(
         x = 1,
         y = count,
         fill = factor(year)
         )
       ) +
  geom_bar(
    stat = "identity", position="fill"
    ) +
  facet_grid(
    gender ~ age_group
    ) +
  coord_polar(
    theta = "y"
    )
```
]]

.column[.content[

&lt;br&gt;

&lt;img src="./figures/outputPie-1.png" style="display: block; margin: auto;" /&gt;

.large[By doing this, you get another pretty chart that's difficult to interpret and unuseful for making comparisons across age groups.]

]]


---

layout: false
class: split-50 with-thick-border border-white



.column[.content[

## Re-arrangement and proximity


```r
tb_au %&gt;% filter(year == 2012) %&gt;%
  ggplot() +
  aes(x=gender, y=count, fill=gender) +
  geom_bar(stat="identity", position="dodge") + 
  facet_wrap(~age_group, ncol=6) +
  scale_fill_brewer("", palette="Dark2") +
  ggtitle("Arrangement A")
```

&lt;img src="./figures/arrA-1.png" style="display: block; margin: auto;" /&gt;
]]

.column[.content[

&lt;br&gt;
&lt;br&gt;


```r
tb_au %&gt;% filter(year == 2012) %&gt;%
  ggplot() +
  aes(x=age_group, y=count, fill=age_group) +
  geom_bar(stat="identity", position="dodge") + 
  facet_wrap(~gender, ncol=6) +
  scale_fill_brewer("", palette="Dark2") +
  ggtitle("Arrangement B")
```

&lt;img src="./figures/arrB-1.png" style="display: block; margin: auto;" /&gt;
]]


---

# Re-arrangement and proximity

.large[
- Arrangement A makes it easier to directly compare male and female counts, separately for each age group. Generally, male counts are higher than female counts. There is a big difference between counts in the 45-54 age group, and over 65 counts are almost the same.
- Arrangement B makes it easier to directly compare counts by age group, separately for females and males. For females, incidence drops in the middle years. For males, it is pretty consistently high across age groups. 
]

&lt;img src="./figures/both-1.png" style="display: block; margin: auto;" /&gt;
---

### Grammar and Statistics


What I love about ggplot2...

&lt;img src="https://www.wired.com/wp-content/uploads/2016/01/DB-Transformation-Colour.gif" style="width: 40%" /&gt;

[Source: https://www.wired.com/wp-content/uploads/2016/01/DB-Transformation-Colour.gif](https://www.wired.com/wp-content/uploads/2016/01/DB-Transformation-Colour.gif)

...you can make so many different displays of the same data, and each time something new may emerge. 

- Grammar of graphics makes rearranging easy
- Its good to look at the data in many different ways [Unwin, Hofmann and Cook](https://journal.r-project.org/archive/2013/RJ-2013-012/RJ-2013-012.pdf)


---

class: middle center bg-main1

# Extensions of ggplot2


---

# gganimate

---

# plotly

---

# simple maps

---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="libs/jquery/jquery.min.js"></script>
<script src="libs/slides.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"ratio": "16:9",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
